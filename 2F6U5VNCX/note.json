{
  "paragraphs": [
    {
      "text": "%spark.pyspark\n\n# define the data frame source on the given column selection/predicates:\ndf \u003d sqlContext.read.parquet(\n    \"/hadoop/gaia/parquet/gdr2/gaia_source/*.parquet\"\n    ).select(\n    [\"designation\",\"source_id\",\"ra\",\"ra_error\",\"dec\",\"dec_error\",\"parallax\",\"parallax_error\",\"parallax_over_error\",\"pmra\",\"pmra_error\",\"pmdec\",\"pmdec_error\",\"l\",\"b\"]\n    ).where(\n    \"abs(b) \u003c 30.0 AND parallax \u003e 1.0 and parallax_over_error \u003e 10.0 AND phot_g_mean_flux_over_error \u003e 36.19 AND astrometric_sigma5d_max \u003c 0.3 AND visibility_periods_used \u003e 8 AND (astrometric_excess_noise \u003c 1 OR (astrometric_excess_noise \u003e 1 AND astrometric_excess_noise_sig \u003c 2))\"\n    )\n\n# sanity check\ndf.show()\nprint (\"Data frame rows: \",df.count())\n\n\n\n\n",
      "user": "admin",
      "dateUpdated": "2020-08-28 09:58:32.001",
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/python",
        "fontSize": 9.0,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+--------------------+-------------------+------------------+--------------------+-------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+-------------------+--------------------+------------------+-------------------+\n|         designation|          source_id|                ra|            ra_error|                dec|           dec_error|          parallax|      parallax_error|parallax_over_error|                pmra|          pmra_error|              pmdec|         pmdec_error|                 l|                  b|\n+--------------------+-------------------+------------------+--------------------+-------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+-------------------+--------------------+------------------+-------------------+\n|Gaia DR2 40396662...|4039666296672658688|272.42180060744215|0.040014912399424604|  -33.6058067001021| 0.03368056050988915| 1.422454370334301| 0.03639988616495275|           39.07854| -0.2316953688797376| 0.07537877095615261| -5.442599071096166| 0.05727019630225524|358.50569414878646|-6.7818037118031835|\n|Gaia DR2 40396673...|4039667327461865216|272.65050482164776|0.036197874417770184| -33.67244054531187| 0.03680133647540661|1.1673137239965692| 0.05314058363370944|           21.96652| -1.7009801509860536| 0.07029452441830816| -4.612361250689048| 0.06085092511704771|358.53690441856696| -6.981138715828702|\n|Gaia DR2 40396638...|4039663822768546432| 272.3987836204827|0.027632276638390182|-33.677978944324124|0.024215370325550427| 1.485547221111856|0.028698903012696158|          51.763206|  -4.537954548081503|0.053742838174843835|-15.585752841174445|0.041699306844425514| 358.4325162212831| -6.799004597798456|\n|Gaia DR2 40396743...|4039674302495016832| 272.6370332645537|0.049971393914832546| -33.46345401655811| 0.04311907194434805|1.4895944391179747| 0.05535383094438027|          26.910412|  -8.999004938426811| 0.08901429663519801|-20.520372339141726| 0.07278953875661565| 358.7173313727555| -6.872875125255238|\n|Gaia DR2 40396798...|4039679804475284224| 272.3352958925287|  0.0382698356897684| -33.49684273645387|   0.037562716485539|1.8288406168863958|0.049118014784077936|            37.2336|  -8.709127050643408| 0.07206191453025368| 0.8317008127357967| 0.05431303815619029|  358.568061282215|  -6.66676412739173|\n|Gaia DR2 40396768...|4039676845112356736| 272.3423038848421| 0.04004613278050688| -33.60277422977108| 0.03534959354180454| 1.331757953116398|0.040852709757309896|           32.59901| -3.0736631636887344| 0.07887016066616566|-10.535097449648152| 0.06167703651701124|358.47687324908384| -6.722021120385618|\n|Gaia DR2 40396799...|4039679976215199616| 272.3870770186676| 0.08175560039135911| -33.49054936039203|   0.075806277430834|1.6828015366409843| 0.09616438158987135|          17.499218|  0.9078068372385885|    0.15609879018991|-1.2743414940340876| 0.12356941230805032| 358.5942080511929|  -6.70183491892182|\n|Gaia DR2 40396779...|4039677948992976896| 272.2946282491588| 0.12673632257759757|-33.562874682533035| 0.11352057025821762|1.2791078599019605| 0.12717607561652478|          10.057771|  2.4788330269377497|  0.2613657929145823| -4.650451848991806| 0.20943502287503454| 358.4933431825897| -6.668151666197993|\n|Gaia DR2 40396646...|4039664686186893184| 272.4026652887885|0.028595834471134035|-33.655006326453886| 0.02471972176840793|1.4230023257454893|0.029119862707883994|           48.86707|  -4.179903049739455|0.055444952571015844| 2.2287270254996123|  0.0428403985184529| 358.4544442439153| -6.791000148338951|\n|Gaia DR2 40396753...|4039675333287149952|  272.560428244972| 0.14485939823543023| -33.41907979107032| 0.13639184748166955|2.4892891798856938| 0.14768574894726139|           16.85531|   2.753665468378671|  0.2764468222685262| -6.187195733058044|  0.2210087660210865|358.72641382590615| -6.795584005240619|\n|Gaia DR2 40396696...|4039669629564951040| 272.7381011527819|0.054428306834246126| -33.56432279582611| 0.04383693249181095|1.4039064198829385| 0.06633427846464744|          21.164116|   3.411131784353724| 0.09135111973361876| -9.646276318124418| 0.08216672365634985| 358.6675940515556| -6.994684164951169|\n|Gaia DR2 40396626...|4039662693254567936| 272.5126080410794|  0.1296423098745303| -33.65215003086476| 0.10917065938921705|1.2421645377888288|  0.1122515594329213|            11.0659|    7.70196276687754| 0.25578905728633683|-17.583724821676032| 0.20088518616997741| 358.5004815041314| -6.870335004176007|\n|Gaia DR2 40396725...|4039672520147052672|272.57023824221136|  0.0736686882516885| -33.51129861096017| 0.06447426562797175| 1.186762299958647| 0.08862786004612552|          13.390398|   2.632117122829801| 0.13686967280780654| 0.3072041918179895|  0.1083246074218071|358.64839146395377| -6.846275843225122|\n|Gaia DR2 40396727...|4039672721944070272| 272.5831112426574| 0.07043976875751465|-33.483537099952784| 0.06291530701296215|  1.14022685446635| 0.08033686117429235|          14.193072|  0.5481922043982299|   0.129302666462865|-3.2025426136016226| 0.10287713081563385|358.67814785261555|-6.8426601585483455|\n|Gaia DR2 40396731...|4039673134263578112|272.47253543660037|0.041702049821903266| -33.51891353312088| 0.03645176703075055|1.1267320071311797|0.047071092260350056|          23.936815|  -1.641507160720163| 0.07769872412607842| -4.671616157042623| 0.06032524035452944| 358.6029327525877| -6.778040244101522|\n|Gaia DR2 40396646...|4039664686186892160|272.40377537872985| 0.04377600533015369| -33.65486867142623|0.037860082819238965|  1.75887165621122|  0.0445294022348985|          39.499107| -0.9566730190113414| 0.08496727540942774| -3.746117897740997|   0.066416625862686|358.45500600935554|  -6.79174955438742|\n|Gaia DR2 40396815...|4039681591181083520| 272.1513758092714| 0.03374330430351806| -33.54770223115408| 0.03215174942793003|1.2770089043898252| 0.03768576974690001|          33.885704| -14.528880635531543| 0.06242652192511705|-1.5617009216815694| 0.05084214045259791|  358.449834180826| -6.555840447573484|\n|Gaia DR2 40396683...|4039668396976095232| 272.5918785069274| 0.06755164731288285| -33.62795490984999|0.060064042374027175| 1.278165908009941| 0.08163770487003097|          15.656564|  -9.059932437739432| 0.12441941818286029| 1.0153309974276419| 0.10066735403770635|358.55330353126215| -6.917141240695328|\n|Gaia DR2 40396782...|4039678253864546816| 272.2796609111014| 0.12881518153071386| -33.51657315885373| 0.11029532166270983|1.1790261056103815| 0.11170275683028853|          10.555032|  -9.837527608593797|  0.2374980846729896| -4.101407578324116|  0.1907102657065912|358.52845560549713| -6.635240808816544|\n|Gaia DR2 40396815...|4039681591181086848| 272.1520450526198| 0.04506019510179999| -33.54255938796362| 0.04309540098315705|1.0121130032598475| 0.04860285626079909|          20.824146|-0.01420160186318746| 0.08474653494512939|-4.1072215733651944| 0.07023090482212226|358.45465735183967| -6.553891056963974|\n+--------------------+-------------------+------------------+--------------------+-------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+-------------------+--------------------+------------------+-------------------+\nonly showing top 20 rows\n\nData frame rows:  21901470\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1588066395625_461038981",
      "id": "20200310-140633_496300561",
      "dateCreated": "2020-04-28 09:33:15.625",
      "dateStarted": "2020-08-28 09:58:32.013",
      "dateFinished": "2020-08-28 10:01:49.997",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\nimport pandas as pd\nimport numpy as np\nspark.conf.set(\"spark.sql.execution.arrow.enabled\", \"true\")\n\n\npandas_df \u003d df.select(\"*\").limit(1000)\ndf.explain(True)\n\n",
      "user": "admin",
      "dateUpdated": "2020-05-28 19:29:37.651",
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/python",
        "fontSize": 9.0,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "\u003d\u003d Parsed Logical Plan \u003d\u003d\n\u0027Filter ((((\u0027abs(\u0027b) \u003c 30.0) \u0026\u0026 (\u0027parallax \u003e 1.0)) \u0026\u0026 ((\u0027parallax_over_error \u003e 10.0) \u0026\u0026 (\u0027phot_g_mean_flux_over_error \u003e 36.19))) \u0026\u0026 (((\u0027astrometric_sigma5d_max \u003c 0.3) \u0026\u0026 (\u0027visibility_periods_used \u003e 8)) \u0026\u0026 ((\u0027astrometric_excess_noise \u003c 1) || ((\u0027astrometric_excess_noise \u003e 1) \u0026\u0026 (\u0027astrometric_excess_noise_sig \u003c 2)))))\n+- Project [designation#270, source_id#271L, ra#274, ra_error#275, dec#276, dec_error#277, parallax#278, parallax_error#279, parallax_over_error#280, pmra#281, pmra_error#282, pmdec#283, pmdec_error#284, l#342, b#343]\n   +- Relation[solution_id#269L,designation#270,source_id#271L,random_index#272L,ref_epoch#273,ra#274,ra_error#275,dec#276,dec_error#277,parallax#278,parallax_error#279,parallax_over_error#280,pmra#281,pmra_error#282,pmdec#283,pmdec_error#284,ra_dec_corr#285,ra_parallax_corr#286,ra_pmra_corr#287,ra_pmdec_corr#288,dec_parallax_corr#289,dec_pmra_corr#290,dec_pmdec_corr#291,parallax_pmra_corr#292,... 70 more fields] parquet\n\n\u003d\u003d Analyzed Logical Plan \u003d\u003d\ndesignation: string, source_id: bigint, ra: double, ra_error: double, dec: double, dec_error: double, parallax: double, parallax_error: double, parallax_over_error: float, pmra: double, pmra_error: double, pmdec: double, pmdec_error: double, l: double, b: double\nProject [designation#270, source_id#271L, ra#274, ra_error#275, dec#276, dec_error#277, parallax#278, parallax_error#279, parallax_over_error#280, pmra#281, pmra_error#282, pmdec#283, pmdec_error#284, l#342, b#343]\n+- Filter ((((abs(b#343) \u003c cast(30.0 as double)) \u0026\u0026 (parallax#278 \u003e cast(1.0 as double))) \u0026\u0026 ((cast(parallax_over_error#280 as double) \u003e cast(10.0 as double)) \u0026\u0026 (cast(phot_g_mean_flux_over_error#318 as double) \u003e cast(36.19 as double)))) \u0026\u0026 (((cast(astrometric_sigma5d_max#311 as double) \u003c cast(0.3 as double)) \u0026\u0026 (cast(visibility_periods_used#310 as int) \u003e 8)) \u0026\u0026 ((astrometric_excess_noise#301 \u003c cast(1 as double)) || ((astrometric_excess_noise#301 \u003e cast(1 as double)) \u0026\u0026 (astrometric_excess_noise_sig#302 \u003c cast(2 as double))))))\n   +- Project [designation#270, source_id#271L, ra#274, ra_error#275, dec#276, dec_error#277, parallax#278, parallax_error#279, parallax_over_error#280, pmra#281, pmra_error#282, pmdec#283, pmdec_error#284, l#342, b#343, phot_g_mean_flux_over_error#318, astrometric_sigma5d_max#311, astrometric_excess_noise#301, visibility_periods_used#310, astrometric_excess_noise_sig#302]\n      +- Relation[solution_id#269L,designation#270,source_id#271L,random_index#272L,ref_epoch#273,ra#274,ra_error#275,dec#276,dec_error#277,parallax#278,parallax_error#279,parallax_over_error#280,pmra#281,pmra_error#282,pmdec#283,pmdec_error#284,ra_dec_corr#285,ra_parallax_corr#286,ra_pmra_corr#287,ra_pmdec_corr#288,dec_parallax_corr#289,dec_pmra_corr#290,dec_pmdec_corr#291,parallax_pmra_corr#292,... 70 more fields] parquet\n\n\u003d\u003d Optimized Logical Plan \u003d\u003d\nProject [designation#270, source_id#271L, ra#274, ra_error#275, dec#276, dec_error#277, parallax#278, parallax_error#279, parallax_over_error#280, pmra#281, pmra_error#282, pmdec#283, pmdec_error#284, l#342, b#343]\n+- Filter ((((((((((((isnotnull(parallax_over_error#280) \u0026\u0026 isnotnull(visibility_periods_used#310)) \u0026\u0026 isnotnull(parallax#278)) \u0026\u0026 isnotnull(astrometric_sigma5d_max#311)) \u0026\u0026 isnotnull(phot_g_mean_flux_over_error#318)) \u0026\u0026 isnotnull(b#343)) \u0026\u0026 (abs(b#343) \u003c 30.0)) \u0026\u0026 (parallax#278 \u003e 1.0)) \u0026\u0026 (cast(parallax_over_error#280 as double) \u003e 10.0)) \u0026\u0026 (cast(phot_g_mean_flux_over_error#318 as double) \u003e 36.19)) \u0026\u0026 (cast(astrometric_sigma5d_max#311 as double) \u003c 0.3)) \u0026\u0026 (cast(visibility_periods_used#310 as int) \u003e 8)) \u0026\u0026 ((astrometric_excess_noise#301 \u003c 1.0) || ((astrometric_excess_noise#301 \u003e 1.0) \u0026\u0026 (astrometric_excess_noise_sig#302 \u003c 2.0))))\n   +- Relation[solution_id#269L,designation#270,source_id#271L,random_index#272L,ref_epoch#273,ra#274,ra_error#275,dec#276,dec_error#277,parallax#278,parallax_error#279,parallax_over_error#280,pmra#281,pmra_error#282,pmdec#283,pmdec_error#284,ra_dec_corr#285,ra_parallax_corr#286,ra_pmra_corr#287,ra_pmdec_corr#288,dec_parallax_corr#289,dec_pmra_corr#290,dec_pmdec_corr#291,parallax_pmra_corr#292,... 70 more fields] parquet\n\n\u003d\u003d Physical Plan \u003d\u003d\n*(1) Project [designation#270, source_id#271L, ra#274, ra_error#275, dec#276, dec_error#277, parallax#278, parallax_error#279, parallax_over_error#280, pmra#281, pmra_error#282, pmdec#283, pmdec_error#284, l#342, b#343]\n+- *(1) Filter ((((((((((((isnotnull(parallax_over_error#280) \u0026\u0026 isnotnull(visibility_periods_used#310)) \u0026\u0026 isnotnull(parallax#278)) \u0026\u0026 isnotnull(astrometric_sigma5d_max#311)) \u0026\u0026 isnotnull(phot_g_mean_flux_over_error#318)) \u0026\u0026 isnotnull(b#343)) \u0026\u0026 (abs(b#343) \u003c 30.0)) \u0026\u0026 (parallax#278 \u003e 1.0)) \u0026\u0026 (cast(parallax_over_error#280 as double) \u003e 10.0)) \u0026\u0026 (cast(phot_g_mean_flux_over_error#318 as double) \u003e 36.19)) \u0026\u0026 (cast(astrometric_sigma5d_max#311 as double) \u003c 0.3)) \u0026\u0026 (cast(visibility_periods_used#310 as int) \u003e 8)) \u0026\u0026 ((astrometric_excess_noise#301 \u003c 1.0) || ((astrometric_excess_noise#301 \u003e 1.0) \u0026\u0026 (astrometric_excess_noise_sig#302 \u003c 2.0))))\n   +- *(1) FileScan parquet [designation#270,source_id#271L,ra#274,ra_error#275,dec#276,dec_error#277,parallax#278,parallax_error#279,parallax_over_error#280,pmra#281,pmra_error#282,pmdec#283,pmdec_error#284,astrometric_excess_noise#301,astrometric_excess_noise_sig#302,visibility_periods_used#310,astrometric_sigma5d_max#311,phot_g_mean_flux_over_error#318,l#342,b#343] Batched: true, Format: Parquet, Location: InMemoryFileIndex[hdfs://stv-dev-master:9000/hadoop/gaia/parquet/gdr2/gaia_source/part-00000-84c9..., PartitionFilters: [], PushedFilters: [IsNotNull(parallax_over_error), IsNotNull(visibility_periods_used), IsNotNull(parallax), IsNotNu..., ReadSchema: struct\u003cdesignation:string,source_id:bigint,ra:double,ra_error:double,dec:double,dec_error:double,...\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1588066395627_1037696999",
      "id": "20200409-172042_1802953724",
      "dateCreated": "2020-04-28 09:33:15.627",
      "dateStarted": "2020-05-28 19:29:37.678",
      "dateFinished": "2020-05-28 19:29:37.907",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\n#import csv\nimport time\nimport numpy as np\n#import pandas as pd\nfrom numpy import cos,sin,pi\n\n\u0027\u0027\u0027Converts the proper motions to km/s and performs a cut of LSR velocity \u003c 60km/s \u0027\u0027\u0027\n\n# converting proper motions (mas/yr --\u003e km/s)\npmra_kms \u003d np.array( pandas_df[\u0027pmra\u0027], dtype\u003dfloat)/(np.array( pandas_df[\u0027parallax\u0027],dtype\u003dfloat))*4.74057;\npmde_kms \u003d np.array(  pandas_df[\u0027pmdec\u0027], dtype\u003dfloat)/(np.array( pandas_df[\u0027parallax\u0027],dtype\u003dfloat))*4.74057;\n\n#insert into the df table\npandas_df.insert(7,\u0027pmra (km/s)\u0027, pmra_kms)\npandas_df.insert(8,\u0027pmdec (km/s)\u0027, pmde_kms)\n\n\n# convert to LSR Units\ndrop\u003d[]\nk\u003d4.74057\nv_sun \u003d np.array((11.1, 12.24, 7.25))\nT\u003d np.array([[-0.05646624, -0.87325802, -0.48397519],\n             [ 0.49253617, -0.44602111,  0.74731071],\n             [-0.86845823, -0.19617746,  0.4552963 ]])\n\ndef LSR_conv(ra,dec,parallax,pmra,pmdec,radial_velocity\u003d0.0):\n    a\u003dra*pi/180     # deg to rad\n    d\u003ddec*pi/180    # deg to rad\n    \n    # define a coordinate matrix\n    A \u003d np.array([[cos(a)*cos(d), -sin(a), -cos(a)*sin(d)],\n              [sin(a)*cos(d), cos(a), -sin(a)*sin(d)],\n              [sin(d), 0, cos(d)]])\n    \n    B \u003d np.matmul(T,A)\n    C \u003d np.array([radial_velocity, k*pmra/(parallax), k*pmdec/(parallax)])\n    U,V,W \u003d np.matmul(B,C)\n    u, v, w \u003d np.array((U,V,W)) + v_sun\n    return [u,v,w]\n\nfor i in range(len(pandas_df)):\n        ra,dec,parallax,pmra,pmdec\u003dnp.asarray(pandas_df.iloc[i][[\u0027ra\u0027,\u0027dec\u0027,\u0027parallax\u0027, \\\n                                                            \u0027pmra\u0027, \u0027pmdec\u0027]], dtype\u003dfloat)\n        x\u003dLSR_conv(ra,dec,parallax,pmra, pmdec)\n        if np.linalg.norm(x)\u003e60:\n            drop.append(i)\n\n# Drops the df if V_lsr \u003e60km/s\ndf\u003dpandas_df.drop(pandas_df.index[drop])\n\nprint(\u0027LSR cut complete\u0027)\n\n# write the new selection with appended columns to the file store to avoid needing to recompute:\n#df.rdd.saveAsTextFile(\"hdfs:///hadoop/temp/kc_hdbscan_inputs.txt\")",
      "user": "admin",
      "dateUpdated": "2020-04-29 17:13:57.591",
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/python",
        "fontSize": 9.0,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "Fail to execute line 10: pmra_kms \u003d np.array( pandas_df[\u0027pmra\u0027], dtype\u003dfloat)/(np.array( pandas_df[\u0027parallax\u0027],dtype\u003dfloat))*4.74057;\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-393219068148220385.py\", line 375, in \u003cmodule\u003e\n    exec(code, _zcUserQueryNameSpace)\n  File \"\u003cstdin\u003e\", line 10, in \u003cmodule\u003e\n  File \"/usr/lib64/python2.7/site-packages/pandas/core/frame.py\", line 2927, in __getitem__\n    indexer \u003d self.columns.get_loc(key)\n  File \"/usr/lib64/python2.7/site-packages/pandas/core/indexes/base.py\", line 2659, in get_loc\n    return self._engine.get_loc(self._maybe_cast_indexer(key))\n  File \"pandas/_libs/index.pyx\", line 108, in pandas._libs.index.IndexEngine.get_loc\n  File \"pandas/_libs/index.pyx\", line 132, in pandas._libs.index.IndexEngine.get_loc\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 1601, in pandas._libs.hashtable.PyObjectHashTable.get_item\n  File \"pandas/_libs/hashtable_class_helper.pxi\", line 1608, in pandas._libs.hashtable.PyObjectHashTable.get_item\nKeyError: \u0027pmra\u0027\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1588066395627_-317489058",
      "id": "20200310-142111_1877616625",
      "dateCreated": "2020-04-28 09:33:15.627",
      "dateStarted": "2020-04-29 17:13:57.616",
      "dateFinished": "2020-04-29 17:13:57.636",
      "status": "ERROR",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\nimport hdbscan\nfrom joblib import Memory\nmem \u003d Memory(cachedir\u003d\u0027hdfs:///hadoop/temp/\u0027)\n\u0027\u0027\u0027 Runs HDBSCAN on the data with predictive data enabled allowing the prediction of WD\u0027s\u0027\u0027\u0027\n\ndf\u003ddf.iloc[:][[\u0027source_id\u0027,\u0027l\u0027, \u0027b\u0027,\u0027ra\u0027,\u0027dec\u0027,\u0027parallax\u0027,\u0027pmra (km/s)\u0027,\u0027pmdec (km/s)\u0027]]\n# df.to_csv(\"df/DR2_with_cuts.csv\", index\u003dNone)\n\n\n# WDs \u003d pd.read_csv(\u0027df/WDs_clustering.csv\u0027)     # White dwarf data\n\n#print(df.shape)\n\n# Apply HDBSCAN with prediction ON full df\ncluster_df \u003d df[[\u0027l\u0027, \u0027b\u0027, \u0027parallax\u0027,\u0027pmra (km/s)\u0027,\u0027pmdec (km/s)\u0027]]\nprint(cluster_df)\nclusterer \u003d hdbscan.HDBSCAN(min_cluster_size\u003d40, \n                            min_samples\u003d2,\n                            prediction_df\u003dTrue, \n                            allow_single_cluster\u003dFalse,\n                            memory\u003dmem,           # Saved to local storage \u0027None\u0027 if this is not possible\n                            cluster_selection_method\u003d\u0027leaf\u0027,\n                            gen_min_span_tree\u003dTrue).fit(cluster_df)\n\n\n# probabilities and group for each object\nprobabilities\u003dclusterer.probabilities_\ngroups\u003dclusterer.labels_\n\n# Info on persistence of groups\npersistence\u003dclusterer.cluster_persistence_\nprint(\u0027Number of Groups \u003d \u0027, max(groups)+1) \n\n\n# np.savetxt(\u0027Groups_persistance_leaf.csv\u0027, persistence)\ndf.insert(8,\u0027group\u0027, groups)\ndf.insert(9,\u0027probability\u0027, probabilities)\n\n# df.to_csv(\"DR2_with_groups_leaf.csv\", index\u003dNone)\nprint(\u0027clustering complete\u0027)\n\n\n# Uses the above clustering to predict WD associations\n\n# WD_cluster\u003dWDs[[\u0027l\u0027, \u0027b\u0027, \u0027Plx\u0027, \u0027pmra (km/s)\u0027, \u0027pmdec (km/s)\u0027]]\n# WD_labels, strengths \u003d hdbscan.approximate_predict(clusterer, WD_cluster)\n# WDs.insert(8,\u0027group\u0027, WD_labels)\n# WDs.insert(9,\u0027probability\u0027, strengths)\n# WDs.to_csv(\"WDs_with_groups_leaf.csv\", index\u003dNone)\n\nprint(\u0027WDs check complete\u0027)\n",
      "user": "admin",
      "dateUpdated": "2020-04-28 09:33:15.628",
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/python",
        "fontSize": 9.0,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "              l         b   parallax  pmra (km/s)  pmdec (km/s)\n0    358.505694 -6.781804   1.422454    -0.772164    -18.138383\n1    358.536904 -6.981139   1.167314    -6.907839    -18.731230\n2    358.432516 -6.799005   1.485547   -14.481190    -49.736118\n3    358.717331 -6.872875   1.489594   -28.638945    -65.305199\n4    358.568061 -6.666764   1.828841   -22.575082      2.155866\n5    358.476873 -6.722021   1.331758   -10.941114    -37.501084\n6    358.594208 -6.701835   1.682802     2.557356     -3.589909\n7    358.493343 -6.668152   1.279108     9.186936    -17.235288\n8    358.454444 -6.791000   1.423002   -13.924870      7.424750\n9    358.726414 -6.795584   2.489289     5.244045    -11.782815\n10   358.667594 -6.994684   1.403906    11.518367    -32.572576\n11   358.500482 -6.870335   1.242165    29.393605    -67.106149\n12   358.648391 -6.846276   1.186762    10.514098      1.227140\n13   358.678148 -6.842660   1.140227     2.279146    -13.314787\n14   358.602933 -6.778040   1.126732    -6.906416    -19.655183\n15   358.455006 -6.791750   1.758872    -2.578457    -10.096663\n16   358.449834 -6.555840   1.277009   -53.934765     -5.797417\n17   358.553304 -6.917141   1.278166   -33.602245      3.765746\n18   358.528456 -6.635241   1.179026   -39.554246    -16.490737\n19   358.454657 -6.553891   1.012113    -0.066518    -19.237547\n20   358.500087 -6.820080   1.146016    -4.957981     -0.020549\n21   358.474819 -6.558913   1.161654   -27.699660    -48.958188\n22   358.481986 -6.795992   1.321398    -0.994138    -23.675979\n23   358.513860 -6.631456   2.734638   -15.667215    -38.830896\n24   358.534856 -6.811587   1.481419   -35.285916    -32.249558\n25   358.691762 -6.982413   1.265479     5.165970    -13.813605\n26   358.599551 -6.837845   8.426658     0.888521    -36.672679\n27   358.462273 -6.544135   1.400488     9.057127    -15.943197\n28   358.548642 -6.801119   2.287142   -12.184507    -37.439813\n29   358.531296 -6.790016   1.290233     9.811377    -22.002808\n..          ...       ...        ...          ...           ...\n967    1.645714 -7.965796   1.210722   -31.117154    -34.104749\n968    1.756686 -7.979495   1.695560   -16.309442     14.226986\n969    1.450521 -8.049079   3.254857    23.223114     -8.953050\n970    1.450257 -8.048785   3.443726    22.308068     -7.454543\n971    1.802651 -7.945791   1.184704   -21.445031    -32.993105\n972    1.401864 -7.798301   1.063268    12.597153     -3.624023\n973    1.407590 -7.990187   1.218296    -6.084324    -60.068076\n974    1.797825 -7.941427   1.251029     7.947801    -39.463147\n975    1.381557 -7.846110   1.511972    21.561614     -3.173061\n977    1.489681 -7.814599   1.637323    26.504770      5.141929\n978    1.405391 -7.653149   1.357995    19.074060    -24.734342\n979    1.384262 -7.678391   1.111862    -1.689282    -11.877422\n980    1.431363 -7.683456   1.060636    -9.253377    -27.626528\n981    1.480751 -8.013516   1.148542     8.538932    -59.118269\n983    1.423753 -7.821427   1.012593   -12.498809    -20.701203\n984    1.447706 -7.862355   1.910167    -3.080213    -11.498664\n985    1.410388 -8.021391  14.375832    12.507292    -27.855533\n986    1.792233 -7.964940   1.095835    10.677669     16.945965\n987    1.437409 -7.742349  10.332828    -2.088039    -20.365352\n988    1.464636 -7.948671   1.120915     4.144629    -24.052191\n989    1.378050 -7.656700   1.119223     9.031112    -17.873233\n990    1.718586 -7.925315   1.090830    -1.636137     10.827011\n991    1.382437 -7.711992   1.375752    -7.150351    -33.821431\n992    1.472237 -7.815401   1.587859     3.484685    -26.887758\n993    1.374048 -7.905404   1.646067    -8.042776     14.637778\n994    1.518570 -8.082213   2.130867     3.585382    -22.265722\n995    1.352693 -7.677183   1.344316    -9.341661    -22.988938\n997    1.658290 -8.034329   1.135129    15.598130    -18.479051\n998    1.455096 -8.071273   1.600873    11.914252    -15.535146\n999    1.745498 -8.018510   1.009264    27.176538     -5.972810\n\n[914 rows x 5 columns]\n________________________________________________________________________________\n[Memory] Calling hdbscan.hdbscan_._hdbscan_boruvka_kdtree...\n_hdbscan_boruvka_kdtree(array([[358.505694, ..., -18.138383],\n       ...,\n       [  1.745498, ...,  -5.97281 ]]), \n2, 1.0, \u0027euclidean\u0027, None, 40, True, True, 4)\n___________________________________________hdbscan_boruvka_kdtree - 0.0s, 0.0min\n(\u0027Number of Groups \u003d \u0027, 5)\nclustering complete\nWDs check complete\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1588066395627_-1936026364",
      "id": "20200319-104018_1699124593",
      "dateCreated": "2020-04-28 09:33:15.627",
      "status": "READY",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n",
      "user": "admin",
      "dateUpdated": "2020-04-28 09:33:15.628",
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1588066395628_1582865152",
      "id": "20200409-195146_1906830473",
      "dateCreated": "2020-04-28 09:33:15.628",
      "status": "READY",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "~Trash/experiments/stv/stv-hdbscan",
  "id": "2F6U5VNCX",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}